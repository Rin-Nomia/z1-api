name: éƒ¨ç½² Continuum API åˆ° HuggingFace

on:
  push:
    branches: [ main ]
  workflow_dispatch:

env:
  HF_USERNAME: RinNomia
  HF_SPACE: continuum-api

jobs:
  deploy:
    runs-on: ubuntu-latest
    timeout-minutes: 20
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      
      - name: Install HuggingFace Hub
        run: |
          pip install huggingface_hub
      
      - name: Deploy to HuggingFace
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: |
          python << 'PYDEPLOY'
          import os
          import time
          from huggingface_hub import HfApi
          from datetime import datetime
          
          token = os.environ['HF_TOKEN']
          username = os.environ['HF_USERNAME']
          space_name = os.environ['HF_SPACE']
          repo_id = f"{username}/{space_name}"
          
          print(f"ðŸš€ éƒ¨ç½²åˆ°: {repo_id}")
          
          api = HfApi(token=token)
          
          # ç¢ºä¿ Space å­˜åœ¨
          try:
              api.space_info(repo_id)
              print(f"âœ… Space å·²å­˜åœ¨")
          except:
              print(f"âš ï¸  å»ºç«‹æ–° Space...")
              api.create_repo(
                  repo_id=repo_id,
                  repo_type="space",
                  space_sdk="docker"
              )
              print(f"âœ… Space å»ºç«‹æˆåŠŸ")
          
          print("\nðŸ“¤ ä¸Šå‚³æª”æ¡ˆ...")
          
          # åˆ†æ‰¹ä¸Šå‚³ï¼Œé¿å… timeout
          files_to_upload = [
              "app.py",
              "Dockerfile",
              "requirements.txt",
              "README.md"
          ]
          
          for file in files_to_upload:
              if os.path.exists(file):
                  try:
                      api.upload_file(
                          path_or_fileobj=file,
                          path_in_repo=file,
                          repo_id=repo_id,
                          repo_type="space"
                      )
                      print(f"âœ… {file}")
                  except Exception as e:
                      print(f"âš ï¸  {file} ä¸Šå‚³å¤±æ•—: {e}")
          
          # ä¸Šå‚³è³‡æ–™å¤¾
          folders = ["pipeline", "core", "configs", "utils"]
          for folder in folders:
              if os.path.exists(folder):
                  try:
                      api.upload_folder(
                          folder_path=folder,
                          path_in_repo=folder,
                          repo_id=repo_id,
                          repo_type="space",
                          ignore_patterns=["*.pyc", "__pycache__"]
                      )
                      print(f"âœ… {folder}/")
                  except Exception as e:
                      print(f"âš ï¸  {folder}/ ä¸Šå‚³å¤±æ•—: {e}")
          
          print("\n" + "=" * 50)
          print("ðŸŽ‰ éƒ¨ç½²å®Œæˆï¼")
          print("=" * 50)
          print(f"\nðŸ“ Space URL:")
          print(f"   https://huggingface.co/spaces/{repo_id}")
          print(f"\nðŸ“ API ç«¯é»ž:")
          print(f"   https://rinnomia-{space_name}.hf.space/health")
          print(f"   https://rinnomia-{space_name}.hf.space/docs")
          print("\nâ³ Space éœ€è¦ 2-5 åˆ†é˜å•Ÿå‹•")
          print("=" * 50)
          PYDEPLOY
---

